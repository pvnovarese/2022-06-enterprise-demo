# This workflow checks out code, builds an image, performs a container image
# scan, evaluates the image, and promotes it if it passes.

name: Anchore Weekly

on: 
  #push:
  #  branches:
  #    - main
  schedule:
    - cron: '52 23 * * 5'
  workflow_dispatch:
    inputs:
      mode:
        description: 'Manual Build'  
        
env:
  ANCHORE_CLI_USER: ${{ secrets.ANCHORE_CLI_USER }}
  ANCHORE_CLI_PASS: ${{ secrets.ANCHORE_CLI_PASS }}
  ANCHORE_CLI_URL: ${{ secrets.ANCHORE_CLI_URL }}
  IMAGE_REGISTRY: ghcr.io
  IMAGE_REGISTRY_REPO: ${IMAGE_REGISTRY}/${GITHUB_REPOSITORY}
  IMAGE_REGISTRY_REPO_TAG: ${IMAGE_REGISTRY}/${GITHUB_REPOSITORY,,}:{GITHUB_REF_NAME}

  
jobs:

  Build-Push:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v2
    - name: Debug Vars
      run: | 
        echo "$IMAGE_REGISTRY"
        echo ${{ env.IMAGE_REGISTRY }}
        echo "$IMAGE_REGISTRY_REPO"
        echo "$IMAGE_REGISTRY_REPO_TAG"
    - name: Login to ghcr.io
      run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${GITHUB_ACTOR} --password-stdin
      


